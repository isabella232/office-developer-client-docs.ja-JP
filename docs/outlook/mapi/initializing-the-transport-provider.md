---
title: トランスポート プロバイダーの初期化
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.localizationpriority: medium
api_type:
- COM
ms.assetid: 977c18ce-ece5-4ad1-ac97-5a680846ab83
description: '最終更新日: 2011 年 7 月 23 日'
ms.openlocfilehash: 36da5f2b2b5135c89480595da506eacc68d232cc
ms.sourcegitcommit: a1d9041c20256616c9c183f7d1049142a7ac6991
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/24/2021
ms.locfileid: "59613892"
---
# <a name="initializing-the-transport-provider"></a>トランスポート プロバイダーの初期化

  
  
**適用対象**: Outlook 2013 | Outlook 2016 
  
トランスポート スプーラー インターフェイスは、MAPI スプーラーがトランスポート プロバイダーに対して行う呼び出しを定義します。 トランスポート プロバイダーは、これらのルーチンをダイナミック リンク ライブラリ (DLL) に実装します。 MAPI スプーラーで使用される DLL への最初の直接エントリ ポイントは、トランスポート プロバイダーの初期化関数 [XPProviderInit である必要があります](xpproviderinit.md)。
  
MAPI は、 **ルーチン GetProcAddress** を使用して、サービス プロバイダーの初期化ルーチンのアドレスを取得し、そのルーチンを呼び出します。 初期化ルーチンの名前は、 **トランスポート プロバイダーの XPProviderInit** です。 他の種類の MAPI サービス プロバイダーでは異なって、1 つの DLL にサービス プロバイダーの種類の任意の組み合わせを含め、特定の種類のサービス プロバイダーは 1 つしか含めないためです。 ただし、特定の種類の 1 つのサービス プロバイダーは、その種類の複数のサービスを実装できます。 たとえば、1 つのトランスポート プロバイダーは、複数のメッセージ サービスにメッセージ トランスポート機能を実装できます。 
  
mapispi.h ヘッダー ファイルには、トランスポート プロバイダー初期化関数の関数プロトタイプの型定義と、その定義済みのプロシージャ名があります。 **GetProcAddress** で使用されるのと同じ名前で C ファイルと C++ ファイルの初期化ルーチンに名前を付け、DLL.DEF ファイルで簡単なエクスポート宣言を使用すると、初期化ルーチンのパラメーターの型チェックが自動的に取得されます。 例については、サンプル トランスポート プロバイダーのソース コードを参照してください。 詳細については、「トランスポート プロバイダーの [サンプル」を参照してください](transport-provider-sample.md)。
  
サービス プロバイダーの初期化呼び出しが成功したが、MAPI が処理するには小さすぎるサービス プロバイダー インターフェイスバージョン番号を返す場合、MAPI は直ちにサービス プロバイダー オブジェクトの **Release** メソッドを呼び出し、初期化呼び出しが MAPI_E_VERSION で失敗した場合と同様に続行します。 この方法で、MAPI とサービス プロバイダーは、処理できるサービス プロバイダー インターフェイスバージョン番号の範囲を共同で定義し、一致しない場合、サービス プロバイダーの読み込みが失敗し、MAPI_E_VERSION戻り値になります。 
  
サービス プロバイダー リソースへのアクセスを取得する MAPI スプーラーの最後の手順は、トランスポート プロバイダーにログオンします。 MAPI スプーラーは、IXPProvider: **XPProviderInit** から返される IUnknown オブジェクトの [IXPProvider::TransportLogon](ixpprovider-transportlogon.md)メソッドを呼び出します。 [](ixpprovideriunknown.md) これは、資格情報を使用する場合にチェックを入れ、ダイアログ ボックスを許可できる呼び出しです。
  
プロセスが同じトランスポート プロバイダーと MAPI セッションで 2 つ目のトランスポート セッションを開く場合、トランスポート プロバイダー DLL は 2 つ目のプロバイダー オブジェクトを作成する必要があります。 1 つ目のプロバイダー オブジェクトを使用して、2 番目のトランスポート セッションにログオンする必要があります。 トランスポート プロバイダーは、1 つのプロバイダー オブジェクトで複数のトランスポート セッションをサポートするためにプログラムする必要があります。 2 つ目のプロバイダー オブジェクトは、異なる MAPI セッションが同じプロセスで使用されている場合にのみ作成する必要があります。
  

