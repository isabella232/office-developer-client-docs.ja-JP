---
title: MAPI アイドル エンジン
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
ms.localizationpriority: medium
api_type:
- COM
ms.assetid: 755d096a-2a61-44d2-a765-5d464a857756
description: '最終更新日: 2015 年 3 月 9 日'
ms.openlocfilehash: c009efbd869b820c52aa2069e4420d473fecc3ee
ms.sourcegitcommit: a1d9041c20256616c9c183f7d1049142a7ac6991
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/24/2021
ms.locfileid: "59561223"
---
# <a name="mapi-idle-engine"></a>MAPI アイドル エンジン

  
  
**適用対象**: Outlook 2013 | Outlook 2016 
  
MAPI には、アイドル エンジンと総称される複数の機能があります。 これらの関数を使用すると、クライアント、アドレス帳プロバイダー、およびメッセージ ストア プロバイダーは、セッションの低速時または低速時にさまざまなタスクを実行できます。 たとえば、クライアントとサービス プロバイダーは、低速の操作を延期したり、長い期間使用されていないファイルを閉じることもできます。 **IXPLogon::Idle** メソッドが実行されるので、トランスポート プロバイダーは通常、アイドル エンジンを使用しない。 詳細については [、「IXPLogon::Idle」を参照してください](ixplogon-idle.md)。
  
アイドル 状態のエンジンを使用するために、クライアントとサービス プロバイダーは、MAPI サブシステムがアイドル状態のときに発生する必要があるタスクを含むコールバック関数を作成します。 MAPI はアイドル時間を検出すると、このコールバック関数を呼び出します。 コールバック関数は、次のように定義された **FNIDLE** プロトタイプに従います。 
  
 `BOOL (STDAPICALLTYPE FNIDLE) (LPVOID lpvContext)`
  
詳細については [、「FNIDLE」を参照してください](fnidle.md)。
  
アイドル エンジンを構成する関数は次のとおりです。
  
[ChangeIdleRoutine](changeidleroutine.md)
  
[DeregisterIdleRoutine](deregisteridleroutine.md)
  
[EnableIdleRoutine](enableidleroutine.md)
  
[FtgRegisterIdleRoutine](ftgregisteridleroutine.md)
  
[MAPIDeInitIdle](mapideinitidle.md)
  
[MAPIInitIdle](mapiinitidle.md)
  
コールバック関数を登録するために、クライアントとサービス プロバイダーは **FtgRegisterIdleRoutine 関数を呼び出** します。 入力パラメーターには、オプションの優先度、入力としてコールバック関数に渡されるメモリブロック、適切な方法で使用する時間、およびオプション フラグのセットが含まれます。 
  
クライアントとサービス プロバイダーは、アイドル関数の実行方法を制御する  _priIdle_ パラメーターで優先度を指定するか、優先度が問題ではない場合は 0 を指定できます。 負の数値は正の数値またはゼロよりも優先度が高いので、圧縮および検索操作には負の数値を割り当てる必要があります。 一度発生するタスクには正の数値を割り当てる必要があります。 
  
アクティブなコールバック関数の登録を解除するために、クライアントとサービス プロバイダーは **DeregisterIdleRoutine 関数を呼び出** します。 **DeregisterIdleRoutine** は非同期的に動作しますので、登録解除呼び出し中、および **DeregisterIdleRoutine** が返された後でも、コールバック関数をいつでも呼び出すことができます。 
  
コールバック関数の一部またはすべての特性を変更するために、クライアントとサービス プロバイダーは **ChangeIdleRoutine 関数を呼び出** します。 **ChangeIdleRoutine は、flags** パラメーター  _ircIdle の設定方法に従って_ 変更を行います。 **ChangeIdleRoutine は** 、関数自体、優先度、時間設定、および入力パラメーターを変更できます。 
  
MAPI は、オペレーティング システムに定義がある場合、オペレーティング システムと同じアイドル状態を定義します。 Win32 では、MAPI はアイドル 状態のタスクをスケジュールするアイドル クラスの優先度を持つスレッドを作成します。 このスレッドは時間を追跡し、スレッドにメッセージを投稿し、実行の時間が到着するとアイドル タスクを実行します。 Win32 は、プロセスではなくスレッドをスケジュールします。 優先度がアイドル優先度より高いタスクがワークステーションで発生している場合は、タスクが完了するまで、アイドル状態のタスクは実行のスケジュールを設定する必要があります。 
  
すべてのアイドル タスクは **、MAPIInitIdle** を呼び出したスレッドで実行されます。 MAPI にはスケジュール用の別のスレッドがありますが、アイドル 状態のタスクが適格になると、メッセージが初期化スレッドにポストバックされ、アイドル タスクがそこで実行されます。 さまざまな種類のクライアントに対する影響は次のとおりです。
  
|**スレッド モデル**|**意味**|
|:-----|:-----|
|シングル スレッド  <br/> |問題ありません。 アイドル関数はクライアントのメイン スレッドで実行され、メッセージ ループを介してシリアル化されます。  <br/> |
|フリー スレッド  <br/> |アイドル状態の関数はスレッド セーフである必要がありますが、クライアントには必要なインフラストラクチャが既に存在します。 クライアントで MAPI アイドル エンジンが必要ない場合があります。  <br/> |
|アパートメント スレッド  <br/> |アイドル関数は、MAPI、OLE、または他の COM インターフェイスを使用する場合は、登録したスレッドと同じスレッドで実行する必要があります。 最も簡単な方法は、適切なスレッドにメッセージを投稿するアイドル関数を MAPI に登録し、そのスレッドのメッセージ ループから "実際の" アイドル関数を直接ディスパッチする方法です。  <br/> |
   

