---
title: MAPI でのメモリの割り当てと解放
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: e238f6bc-e9f6-4ea4-a2e4-ff5da2a04bd5
description: '最終更新日: 2015 年 3 月 9 日'
ms.openlocfilehash: 68250c5cbeaa366ed4555bb469c4e68d62302f28
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/28/2019
ms.locfileid: "33419668"
---
# <a name="allocating-and-freeing-memory-in-mapi"></a>MAPI でのメモリの割り当てと解放

  
  
**適用対象**: Outlook 2013 | Outlook 2016 
  
MAPI は、メモリの割り当ておよび解放方法を指定する以外に、パブリック インターフェイス メソッドと API 関数呼び出しの間で渡されるメモリを解放する必要がある場合を知るモデルを定義します。 このモデルは、文字列や構造体へのポインターなど、インターフェイスへのポインターではないパラメーターに割り当てられたメモリにのみ適用されます。 インターフェイス ポインターは **、IUnknown** を介して実装された参照カウント メカニズムを使用します。 クライアント アプリケーションまたはサービス プロバイダー内で MAPI 以外の関連メモリを内部的に割り当て、解放する場合は、意味のあるメカニズムを使用します。 
  
モデルは、パラメーターを 3 つの種類の 1 つとして定義します。 これらは、呼び出された関数またはメソッドによって使用される情報を呼び出し元が設定する入力パラメーター、呼び出し元の関数またはメソッドによって設定された出力パラメーター、呼び出し元に返される入力パラメーター、または 2 つの型の組み合わせの入出力パラメーターです。 出力パラメーターは、多くの場合、データへのポインターまたはデータへのポインターです。 呼び出された関数は、出力パラメーターのデータを割り当てるのを担当しますが、呼び出し元はポインターのメモリを割り当てる。 
  
これらの種類のパラメーターのメモリを割り当て、解放するルールについて、次の表で説明します。
  
|**Type**|**メモリ割り当て**|**メモリの解放**|
|:-----|:-----|:-----|
|Input  <br/> |呼び出し元は責任を負い、任意のメカニズムを使用できます。  <br/> |呼び出し元は責任を負い、任意のメカニズムを使用できます。  <br/> |
|出力  <br/> |呼び出された関数は責任を負い **、MAPIAllocateBuffer を使用する必要があります**。 詳細については [、「MAPIAllocateBuffer」を参照してください](mapiallocatebuffer.md)。  <br/> |呼び出し元は責任を負い **、MAPIFreeBuffer を使用する必要があります**。 詳細については [、「MAPIFreeBuffer」を参照してください](mapifreebuffer.md)。  <br/> |
|入出力  <br/> |呼び出し元は、最初の割り当てを担当し、呼び出された関数は **、MAPIAllocateBuffer** を使用して必要に応じて再割り当てできます。  <br/> |呼び出された関数は、必要に応じて初期解放を行います。 呼び出し元は、最終的な戻り値を解放する必要があります。  <br/> |
   
エラー状態の間、インターフェイス メソッドの実装者は、一般的に呼び出し元がそれらをクリーンアップする方法がないので、出力パラメーターと入出力パラメーターに注意を払う必要があります。 エラーが返された場合、各出力または入出力パラメーターは、呼び出し元によって初期化された値に残す必要があります。または呼び出し元の部分に対するアクションを実行せずにクリーンアップできる値に設定する必要があります。 たとえば、出力ポインター パラメーターは、入力時に残す必要があります。または  `void ** ppv` NULL ( ) に設定できます  `*ppv = NULL` 。
  

