---
title: Advise Sink オブジェクトの実装
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
ms.localizationpriority: medium
api_type:
- COM
ms.assetid: 7461c4f6-7030-4ba2-ada4-26ebfbbfa001
description: '最終更新日: 2015 年 3 月 9 日'
ms.openlocfilehash: 5b0873575cd06ca044364009785c9d87533cbad1
ms.sourcegitcommit: a1d9041c20256616c9c183f7d1049142a7ac6991
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/24/2021
ms.locfileid: "59620751"
---
# <a name="implementing-an-advise-sink-object"></a>Advise Sink オブジェクトの実装

  
  
**適用対象**: Outlook 2013 | Outlook 2016 
  
クライアントは、独自のアアドバイス シンク オブジェクトを実装するか、ユーティリティ関数 [HrAllocAdviseSink を使用できます](hrallocadvisesink.md)。 **HrAllocAdviseSink** は、コールバック関数を呼び出す **OnNotify** の実装を持つアアドバイス シンク オブジェクトを作成します。 
  
**HrAllocAdviseSink** を使用する利点と欠点があります。 作業を保存できますが、作成するアアドバイス シンク オブジェクトをカウントする参照を制御しません。 したがって、アドバイス シンクのリリースを慎重に制御する必要があるクライアント、またはアアドバイス シンクと別のクライアント オブジェクトの間に相互依存関係があるクライアントは、独自の **IMAPIAdviseSink** 実装を構築し **、HrAllocAdviseSink** の使用を完全に回避する必要があります。 
  
独自のアアドバイス シンクを実装するクライアントは、参照カウントとオブジェクトの解放における潜在的な複雑性を排除するために、他のオブジェクトに関連しない、または依存しない独立したオブジェクトにする必要があります。 ただし、別のオブジェクトの一部としてアアドバイス シンクを実装する必要がある場合や、別のオブジェクトへの戻りポインターをデータ メンバーとして含める必要がある場合は、2 つの個別の参照カウント (1 つは、アアドバイス シンクで参照されるオブジェクト用とアアドバイス シンク用) を維持する必要があります。 
  
参照先のオブジェクトの参照カウントが 0 に設定されると、すべてのメソッドが失敗し、その vtable を破棄できますが、参照カウントが 0 に落ちるまで、アアドバイス シンクのメモリはそのまま残る必要があります。 つまり、アアドバイス シンクの **Release** メソッドは、参照カウントをデクレメントし、そのカウントが 0 に達したときにオブジェクトの破棄を終了する必要があります。 2 つの個別の参照カウントを維持しない場合、対象オブジェクトの Release プロセスの一部として、アアドバイス シンクを誤って破棄するのは **簡単** です。 
  
**HrAllocAdviseSink** を使用してアアドバイス シンクを実装するクライアントは、コールバック関数を別のアアドバイス シンク オブジェクトにメソッドとして含めないように同様に注意する必要があります。 C++ クライアントの場合、これを行い、この  _ポインターをパラメーター_ として渡すのは魅力的です。 クライアントは通常、参照カウントが 0 に達したときにオブジェクトを解放する場合、これは危険な戦略です。 アアドバイス シンク オブジェクトのメモリを解放すると、このポインターは  _無効_ になります。 
  
イベントの種類とアドバイス ソースに応じて **、OnNotify** メソッドはさまざまな方法でイベントを処理できます。 次の表では、標準的なイベントの一部を処理する方法について提案します。 
  
|**イベントの種類**|**OnNotify での処理**|
|:-----|:-----|
|オブジェクトの移動  <br/> |移動したオブジェクトの元の親が新しい親に関連付けされている場合は、階層内で最も高いフォルダーまたはアドレス帳コンテナーで始まるビューを更新します。 2 つの親コンテナーが関連付けされていない場合は、両方のビューを更新します。  <br/> |
|新しいメッセージ  <br/> |ユーザー インターフェイスを変更して、1 つ以上の新しいメッセージの到着をユーザーに通知します。 現在のビューに受信フォルダーを配置します。  <br/> |
|Error  <br/> |セッションを除くすべてのオブジェクトに対して、必要に応じてエラーをログに記録し、戻します。 セッション オブジェクトの場合は、可能であればログオフします。  <br/> |
|検索の完了  <br/> |処理は不要です。  <br/> |
   
> [!NOTE]
> 通知ハンドラーは再入可能である必要があります。 
  

