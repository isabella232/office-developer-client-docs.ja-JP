---
title: トランスポート プロバイダーTNEF-Enabled開発する
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.localizationpriority: medium
api_type:
- COM
ms.assetid: 7525eee1-4016-49b8-9509-5ebbe1db819f
description: '最終更新日: 2011 年 7 月 23 日'
ms.openlocfilehash: 30b61b1cd8645aa0fa0bc67e89507f1827ea8e95
ms.sourcegitcommit: a1d9041c20256616c9c183f7d1049142a7ac6991
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/24/2021
ms.locfileid: "59584606"
---
# <a name="developing-a-tnef-enabled-transport-provider"></a>トランスポート プロバイダーTNEF-Enabled開発する

  
  
**適用対象**: Outlook 2013 | Outlook 2016 
  
MAPI 機能の異なるセットをサポートするメッセージング システム間の相互運用性を促進するために、MAPI はデータを転送する標準的な方法としてトランスポート ニュートラル カプセル化形式 (TNEF) を提供します。 この形式は、基になるメッセージング システムでサポートされていない MAPI プロパティをバイナリ ストリームにカプセル化し、トランスポート プロバイダーがメッセージを送信するときにメッセージと共に転送できます。 メッセージを受信するトランスポート プロバイダーは、バイナリ ストリームをデコードして、元のメッセージのすべてのプロパティを取得し、それらをクライアント アプリケーションで使用できます。 TNEF の運用モデルは次の操作モデルです。
  
- メッセージング クライアントは、通常通り TNEF トランスポートにメッセージを送信および受信します。
    
- トランスポートは、送信メッセージのプロパティを、基になるメッセージ システムがサポートするカテゴリとサポートしないカテゴリの 2 つのカテゴリに分けられます。 基になるメッセージング システムでサポートされているプロパティの値は、必要な形式に変換されます。
    
- トランスポートでは、MAPI TNEF メソッドを使用して、サポートされていないプロパティを 1 つのデータ ストリームにエンコードします。 トランスポートは、メッセージを送信する前に、基になるメッセージング システムの添付ファイル モデルを使用して、そのデータ ストリームを送信メッセージの特別な添付ファイルに変換します。
    
- このようなメッセージを受信する TNEF が有効なトランスポートでは、2 つの処理が行います。 最初に、受信メッセージのプロパティ (基になるメッセージ システムでサポートされているプロパティ) を MAPI プロパティに変換します。 次に、特別な添付ファイルが存在する場合は、MAPI TNEF メソッドを使用して添付ファイルから追加の MAPI プロパティを取得してから、メッセージをクライアント アプリケーションに配信します。
    
MAPI は、TNEF オブジェクトを操作するときに MAPI トランスポート プロバイダーが使用する **ITnef** インターフェイスの実装を提供します。 [OpenTnefStreamEx](opentnefstreamex.md)関数は、TNEF オブジェクトを作成し、それらをメッセージに関連付ける場合に使用します。 TNEF ストリームは、OLE IStream インターフェイスの上 **に構築** されます。 
  
> [!NOTE]
> **OpenTnefStreamEx を使用して** TNEF オブジェクトを作成します。 古い **OpenTnefStream** 関数は、古いソース コードとの互換性のためにまだ存在し、新しいソース コードでは使用できません。 
  
**ITnef インターフェイスには**、次のメソッドがあります。 
  
- [AddProps](itnef-addprops.md)
    
- [EncodeRecips](itnef-encoderecips.md)
    
- [ExtractProps](itnef-extractprops.md)
    
- [Finish](itnef-finish.md)
    
- [FinishComponent](itnef-finishcomponent.md)
    
- [OpenTaggedBody](itnef-opentaggedbody.md)
    
- [SetProps](itnef-setprops.md)
    
MAPI TNEF 実装モデルでは、次の機能がサポートされています。
  
- 他のメッセージ プロパティに影響を与えることなく、すべての MAPI プロパティ。 MAPI メッセージがメッセージング システムを介したトランスポートを存続するには、メッセージング システムのプロパティとしてエンコードできないすべてのプロパティをカプセル化する必要があります。 MAPI 準拠のクライアントがメッセージを受信するかどうかは、メッセージが送信された時点ではほとんど分かっていないので、カプセル化スキームを使用すると、トランスポート プロバイダーはメッセージング システムがネイティブにサポートしていない MAPI メッセージ プロパティのみをエンコードできます。 つまり、TNEF を使用するメッセージは、SMTP ベースのメッセージング システムなどの MAPI に基づいておらないメッセージング システムUNIX意味します。 これらのシステムは、サポートするプロパティを通常の方法で受け取り、他のプロパティはエンコードされた TNEF データ ストリームとして受信されます。 TNEF トランスポート プロバイダーは、これら 2 つのプロパティ セットを区別し、メッセージング システムに対して適切な方法でサポートされているセットを送信する責任があります。 TNEF は、メッセージング システムによって提供されるサポートのレベルを前提とします。 ただし、このセクションに含まれる TNEF 使用法の例では、メッセージング システムがメッセージ以外に少なくとも 1 つの添付ファイルをサポートすると仮定されています。 場合によっては、添付ファイルは uuencoded ストリームを介してのみサポートされ、メッセージ テキストの一部として送信できます。 非常にまれな状況でのみ、メッセージング システムはメッセージ プロパティをほとんどサポートしないので、すべてのプロパティの完全な TNEF エンコードが必要になります。
    
- 受信メッセージの TNEF ストリームが、MAPI プロパティ PR_TNEF_CORRELATION_KEY ([PidTagTnefCorrelationKey)](pidtagtnefcorrelationkey-canonical-property.md)に基づいてメッセージに属するかどうかを判断するメカニズム。  このプロパティは、TNEF ストリームと適切なメッセージ ヘッダーの両方にあります。 プロパティが両方の場所で同じ値を持っている場合、またはいずれかの場所に存在しない場合、TNEF ストリームはメッセージに属すると見なされます。 それ以外の場合、TNEF ストリームは無視されます。 TNEF が有効なトランスポートは、送信メッセージでこのプロパティの値を選択し、適切なメッセージ ヘッダー (たとえば、SMTP メッセージの Message-ID: ヘッダー) と TNEF ストリームでエンコードします。
    

