---
title: éåŒæœŸã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©é–¢æ•°
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.topic: overview
localization_priority: Normal
ms.assetid: 142eb27e-fb6f-4da3-bfb7-a88115bbb5d5
description: 'ï¿½Kï¿½pï¿½Îï¿½: Excel 2013?| Office 2013?| Visual Studio'
ms.openlocfilehash: 5b64dfd4308da4efb5e94010fe1dc9d758a1199c
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/11/2018
ms.locfileid: "19798755"
---
# <a name="asynchronous-user-defined-functions"></a><span data-ttu-id="2eb4c-103">éåŒæœŸã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©é–¢æ•°</span><span class="sxs-lookup"><span data-stu-id="2eb4c-103">Asynchronous user-defined functions</span></span>

<span data-ttu-id="2eb4c-104">**é©ç”¨ã•ã‚Œã¾ã™**Excel 2013 |ã€‚Office 2013 |Visual Studio</span><span class="sxs-lookup"><span data-stu-id="2eb4c-104">**Applies to**: Excel 2013 | Office 2013 | Visual Studio</span></span> 
  
<span data-ttu-id="2eb4c-105">Microsoft Excel 2013 ã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©é–¢æ•°ã‚’éåŒæœŸçš„ã«å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚</span><span class="sxs-lookup"><span data-stu-id="2eb4c-105">Microsoft Excel 2013 can call user-defined functions asynchronously.</span></span> <span data-ttu-id="2eb4c-106">é–¢æ•°ã‚’éåŒæœŸçš„ã«å‘¼ã³å‡ºã™ã¨ã€ã„ãã¤ã‹ã®è¨ˆç®—ã‚’åŒæ™‚ã«å®Ÿè¡Œã‚’è¨±å¯ã™ã‚‹ã“ã¨ã§ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒå‘ä¸Šã§ãã¾ã™ã€‚</span><span class="sxs-lookup"><span data-stu-id="2eb4c-106">Calling functions asynchronously can improve performance by allowing several calculations to run at the same time.</span></span> <span data-ttu-id="2eb4c-107">è¨ˆç®—ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©é–¢æ•°ã‚’å®Ÿè¡Œã™ã‚‹ã¨ãã«é–¢æ•°ã®å‘¼ã³å‡ºã—ã‚’éåŒæœŸçš„ã«è¨ˆç®—ã‚’å®Œäº†ã™ã‚‹ãŸã‚ã«ã„ãã¤ã‹ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚</span><span class="sxs-lookup"><span data-stu-id="2eb4c-107">When you run user-defined functions on a compute cluster, calling functions asynchronously enables several computers to be used to complete the calculations.</span></span>
  
## <a name="when-to-use-asynchronous-user-defined-functions"></a><span data-ttu-id="2eb4c-108">éåŒæœŸã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©é–¢æ•°ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ</span><span class="sxs-lookup"><span data-stu-id="2eb4c-108">When to use asynchronous user-defined functions</span></span>

<span data-ttu-id="2eb4c-109">ã„ãã¤ã‹ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©é–¢æ•°ã¯ã€å¤–éƒ¨ãƒªã‚½ãƒ¼ã‚¹ã‚’å¾…ã¤å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</span><span class="sxs-lookup"><span data-stu-id="2eb4c-109">Some user-defined functions must wait for external resources.</span></span> <span data-ttu-id="2eb4c-110">ã€å¾…æ©Ÿä¸­ã«ã€Excel è¨ˆç®—ã‚¹ãƒ¬ãƒƒãƒ‰ã¯ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã™ã€‚</span><span class="sxs-lookup"><span data-stu-id="2eb4c-110">While they wait, the Excel calculation thread is blocked.</span></span> <span data-ttu-id="2eb4c-111">2013 å¹´ Excel ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©é–¢æ•°ã‚’éåŒæœŸçš„ã«å®Ÿè¡Œã§ãã¾ã™ã€‚</span><span class="sxs-lookup"><span data-stu-id="2eb4c-111">In Excel 2013, user-defined functions can run asynchronously.</span></span> <span data-ttu-id="2eb4c-112">ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©é–¢æ•°ã¯å¾…æ©Ÿä¸­ã«ä»–ã®è¨ˆç®—ã‚’å®Ÿè¡Œã™ã‚‹è¨ˆç®—ã®ã‚¹ãƒ¬ãƒƒãƒ‰ãŒè§£æ”¾ã•ã‚Œã¾ã™ã€‚</span><span class="sxs-lookup"><span data-stu-id="2eb4c-112">This frees the calculation thread to run other calculations while the user-defined function waits.</span></span>
  
<span data-ttu-id="2eb4c-113">Excel 2007 ã§ã¯ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒã«ã‚ˆã£ã¦å®Ÿè¡Œã§ãã¾ã™è¤‡æ•°ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©é–¢æ•°ã‚’åŒæ™‚ã«è¤‡æ•°ã‚¹ãƒ¬ãƒƒãƒ‰ã®å†è¨ˆç®—ã«ä½¿ç”¨ã•ã‚Œã‚‹ã‚¹ãƒ¬ãƒƒãƒ‰ã®æ•°ã‚’å¢—ã‚„ã—ã¾ã™ã€‚</span><span class="sxs-lookup"><span data-stu-id="2eb4c-113">In Excel 2007, programmers could run multiple user-defined functions at the same time by increasing the number of threads used in multiple-thread recalculations.</span></span> <span data-ttu-id="2eb4c-114">ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã§ã¯ã€ã‚¹ãƒ¬ãƒƒãƒ‰ã®æ•°ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å¯¾è±¡ã«ã—ãŸè¨­å®šã§ã‚ã‚Šã€ãƒ¬ãƒ™ãƒ«ã® 1 ã¤ã®é–¢æ•°ã¾ãŸã¯ã‚¢ãƒ‰ã‚¤ãƒ³ã‚’åˆ¶å¾¡ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ãŒä¸»ãªç†ç”±ã«æ¬ ç‚¹ãŒã‚ã‚Šã¾ã™ã€‚</span><span class="sxs-lookup"><span data-stu-id="2eb4c-114">This method has drawbacks primarily because the number of threads is a setting scoped to an application and cannot be controlled at the level of a single function or an add-in.</span></span>
  
<span data-ttu-id="2eb4c-p104">ï¿½Öï¿½ï¿½ï¿½ï¿½Oï¿½ï¿½ï¿½ï¿½ï¿½\ï¿½[ï¿½Xï¿½ï¿½Ò‚Â•Kï¿½vï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ê‡ï¿½Aï¿½vï¿½ï¿½ï¿½Oï¿½ï¿½ï¿½}ï¿½[ï¿½Í”ñ“¯Šï¿½ï¿½Ìƒï¿½ï¿½[ï¿½Uï¿½[ï¿½ï¿½\`ï¿½Öï¿½ï¿½ÌŒÄ‚Ñoï¿½ï¿½ï¿½ï¿½gï¿½pï¿½ï¿½ï¿½ï¿½Kï¿½vï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ü‚ï¿½ï¿½Bï¿½ï¿½ï¿½Æ‚ï¿½ï¿½ÎAï¿½Cï¿½ï¿½ï¿½^ï¿½[ï¿½lï¿½bï¿½gï¿½ï¿½ï¿½ SOAP ï¿½vï¿½ï¿½ï¿½ğ‘—Mï¿½ï¿½ï¿½ï¿½Öï¿½ï¿½ÍAï¿½lï¿½bï¿½gï¿½ï¿½ï¿½[ï¿½Nï¿½Å—vï¿½ï¿½ï¿½ï¿½ï¿½zï¿½Mï¿½ï¿½ï¿½ï¿½Aï¿½ï¿½ï¿½ï¿½ï¿½[ï¿½g ï¿½Tï¿½[ï¿½oï¿½[ï¿½Å—vï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Aï¿½lï¿½bï¿½gï¿½ï¿½ï¿½[ï¿½Nï¿½ÅŒï¿½ï¿½Ê‚ï¿½ï¿½Ô‚ï¿½ï¿½ï¿½ï¿½Ì‚ï¿½Ò‚Â•Kï¿½vï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ü‚ï¿½ï¿½Bï¿½ï¿½ï¿½Ìê‡ï¿½Aï¿½dï¿½vï¿½ÈƒRï¿½ï¿½ï¿½sï¿½ï¿½ï¿½[ï¿½eï¿½Bï¿½ï¿½ï¿½Oï¿½Í”ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½AExcel ï¿½Å‘ï¿½ï¿½ÌŒvï¿½Zï¿½ï¿½pï¿½ï¿½ï¿½ï¿½ï¿½Äsï¿½ï¿½ï¿½ï¿½ï¿½Æ‚ï¿½ï¿½Å‚ï¿½ï¿½Ü‚ï¿½ï¿½B</span><span class="sxs-lookup"><span data-stu-id="2eb4c-p104">Programmers should use asynchronous user-defined function calls when the function must wait for external resources. For example, a function that sends a SOAP request over the Internet must wait for the network to deliver the request, the remote server to complete the request, and the network to return the result. In this case, there is no significant computing occurring and Excel can continue with other calculations.</span></span>
  
<span data-ttu-id="2eb4c-p105">ï¿½Öï¿½ï¿½ï¿½ï¿½vï¿½Zï¿½Nï¿½ï¿½ï¿½Xï¿½^ï¿½[ï¿½É—vï¿½ï¿½ï¿½ğ‘—Mï¿½ï¿½ï¿½Ä‚ï¿½ï¿½ï¿½ê‡ï¿½Aï¿½vï¿½ï¿½ï¿½Oï¿½ï¿½ï¿½}ï¿½[ï¿½Í”ñ“¯Šï¿½ï¿½Ìƒï¿½ï¿½[ï¿½Uï¿½[ï¿½ï¿½\`ï¿½Öï¿½ï¿½ï¿½gï¿½pï¿½ï¿½ï¿½é‚±ï¿½Æ‚ï¿½Å‚ï¿½ï¿½Ü‚ï¿½ï¿½Bï¿½ï¿½ï¿½Ìê‡ï¿½Aï¿½lï¿½bï¿½gï¿½ï¿½ï¿½[ï¿½Nï¿½Ì’xï¿½ï¿½ï¿½ï¿½Ò‚Â‚ï¿½ï¿½ï¿½ï¿½Å‚È‚ï¿½ï¿½Aï¿½Nï¿½ï¿½ï¿½Xï¿½^ï¿½[ï¿½ÍŒÂXï¿½ÌŒÄ‚Ñoï¿½ï¿½ï¿½ï¿½ÊXï¿½ÌƒTï¿½[ï¿½oï¿½[ï¿½Åï¿½ï¿½sï¿½Å‚ï¿½ï¿½Ü‚ï¿½ï¿½Bï¿½ÂXï¿½ÌŒÄ‚Ñoï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ü‚Å‘Ò‚ï¿½ï¿½È‚ï¿½ï¿½ï¿½ï¿½Æ‚É‚ï¿½ï¿½Aï¿½Ä‚Ñoï¿½ï¿½ï¿½ï¿½dï¿½ï¿½ï¿½ï¿½ï¿½é‚±ï¿½Æ‚ï¿½ï¿½Å‚ï¿½ï¿½é‚½ï¿½ßƒpï¿½tï¿½Hï¿½[ï¿½}ï¿½ï¿½ï¿½Xï¿½ï¿½ï¿½ï¿½ï¿½Pï¿½ï¿½ï¿½Ü‚ï¿½ï¿½Bï¿½ê‡ï¿½É‚ï¿½ï¿½ï¿½Ä‚ÍAï¿½å•ï¿½É‰ï¿½ï¿½Pï¿½ï¿½ï¿½Ü‚ï¿½ï¿½B</span><span class="sxs-lookup"><span data-stu-id="2eb4c-p105">Programmers can also use asynchronous user-defined functions when a function is sending requests to a compute cluster. In this case, there is not only network latency to wait for, but the cluster can execute separate calls on separate servers. By not waiting for each call to finish, the calls can be overlapped to improve performance. In some cases this improvement is significant.</span></span>
  
> [!NOTE]
> <span data-ttu-id="2eb4c-122">ï¿½ï¿½ï¿½[ï¿½Uï¿½[ï¿½ï¿½\`ï¿½Öï¿½ï¿½ÍAï¿½ñ“¯Šï¿½ï¿½ÆƒNï¿½ï¿½ï¿½Xï¿½^ï¿½[ ï¿½Zï¿½[ï¿½tï¿½Ì—ï¿½ï¿½ï¿½ï¿½Æ‚ï¿½ï¿½Ä“oï¿½^ï¿½ï¿½ï¿½é‚±ï¿½Æ‚Í‚Å‚ï¿½ï¿½Ü‚ï¿½ï¿½ï¿½B</span><span class="sxs-lookup"><span data-stu-id="2eb4c-122">User-defined functions cannot be registered as both asynchronous and cluster safe.</span></span> 
  
## <a name="writing-an-asynchronous-user-defined-function"></a><span data-ttu-id="2eb4c-123">éåŒæœŸã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©é–¢æ•°ã®è¨˜è¿°</span><span class="sxs-lookup"><span data-stu-id="2eb4c-123">Writing an asynchronous user-defined function</span></span>

<span data-ttu-id="2eb4c-p106">éåŒæœŸã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©é–¢æ•°ã¯ãƒãƒ³ãƒ‰ãƒ«ã‚’è¿½è·¡ã—ã€Excel ã«é–¢æ•°ã®å‘¼ã³å‡ºã—ãŒå®Œäº†ã—ãŸã“ã¨ã‚’é€šçŸ¥ã™ã‚‹éš›ã«ãã®ãƒãƒ³ãƒ‰ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚éåŒæœŸã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©é–¢æ•°ã¯ 2 ã¤ã®éƒ¨åˆ†ã«åˆ†å‰²ã•ã‚Œã¾ã™ã€‚æœ€åˆã®éƒ¨åˆ†ã¯æ¨™æº–ã® UDF ã‚¨ãƒ³ãƒˆãƒª ãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€2 ç•ªç›®ã®åˆ¥ã®éåŒæœŸæ“ä½œãŒé–‹å§‹ã•ã‚Œã¾ã™ã€‚Excel ã¸ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¯ã€UDF ã‚¨ãƒ³ãƒˆãƒª ãƒã‚¤ãƒ³ãƒˆã®é–“ã«è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã®å¾Œã€é–¢æ•°ã®æœ€åˆã®é–‹å§‹éƒ¨åˆ†ã§ã¯ã€ãã®è¨ˆç®—ã‚¹ãƒ¬ãƒƒãƒ‰ã®åˆ¶å¾¡ã‚’ Excel ã«è¿”ã—ã€Excel ã«ã‚ˆã£ã¦è¨ˆç®—ãŒç¶™ç¶šã•ã‚Œã¾ã™ã€‚2 ç•ªç›®ã®éåŒæœŸæ“ä½œãŒå®Œäº†ã™ã‚‹ã¨ã€Excel ã«ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã—ã¦çµæœã‚’ Excel ã«æä¾›ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ </span><span class="sxs-lookup"><span data-stu-id="2eb4c-p106">Asynchronous user-defined functions must keep track of a handle and use that handle when informing Excel that the function call is finished. An asynchronous user-defined function is split into two pieces. The first piece is the standard UDF entry point, which will launch a second, separate asynchronous operation. Callbacks into Excel should be made during the UDF entry point. The first launching portion of the function will then return control of its calculation thread to Excel, which will continue calculation. When the second asynchronous operation is complete, it must call back into Excel and provide Excel with its result.</span></span> 
  
> [!NOTE]
> <span data-ttu-id="2eb4c-130">ï¿½ñ“¯Šï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Å•Kï¿½vï¿½ï¿½ UDF ï¿½É“nï¿½ï¿½ï¿½ê‚½ï¿½ï¿½ï¿½×‚Ä‚Ìˆï¿½ï¿½ï¿½ï¿½É‚Â‚ï¿½ï¿½Ä‚ÍAUDF ï¿½Gï¿½ï¿½ï¿½gï¿½ï¿½ ï¿½|ï¿½Cï¿½ï¿½ï¿½gï¿½ï¿½ï¿½Ô‚ï¿½ï¿½ê‚½ï¿½Æ‚ï¿½ï¿½ï¿½ Excel ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ìˆï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½é‚½ï¿½ßAï¿½Öï¿½ï¿½ÌÚ×‚ï¿½ï¿½Rï¿½sï¿½[ï¿½ï¿½ï¿½ï¿½È‚ï¿½ï¿½ï¿½Î‚È‚ï¿½Ü‚ï¿½ï¿½ï¿½B</span><span class="sxs-lookup"><span data-stu-id="2eb4c-130">Any arguments passed into the UDF that are needed by the asynchronous portion the function must be deep copied because Excel frees these arguments when the UDF entry point returns.</span></span> 
  
<span data-ttu-id="2eb4c-p107">Excel ï¿½Å‚ÍAï¿½ñ“¯Šï¿½ï¿½ï¿½ UDF ï¿½Ä‚Ñoï¿½ï¿½ï¿½Ìƒï¿½ï¿½Cï¿½t ï¿½Tï¿½Cï¿½Nï¿½ï¿½ï¿½ï¿½Ç—ï¿½ï¿½ï¿½ï¿½é‚½ï¿½ßAXLL ï¿½Aï¿½hï¿½Cï¿½ï¿½ï¿½ï¿½ï¿½gï¿½ï¿½ï¿½ï¿½ï¿½Æ‚Ì‚Å‚ï¿½ï¿½ï¿½Cï¿½xï¿½ï¿½ï¿½gï¿½ÌƒZï¿½bï¿½gï¿½ï¿½ï¿½ñ‹Ÿ‚ï¿½ï¿½ï¿½Ü‚ï¿½ï¿½Bï¿½ï¿½ï¿½ï¿½ï¿½ÌƒCï¿½xï¿½ï¿½ï¿½gï¿½ÍAExcel ï¿½Å‚ÌŒvï¿½Zï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Aï¿½vï¿½Zï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ê‚½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ü‚ï¿½ï¿½B</span><span class="sxs-lookup"><span data-stu-id="2eb4c-p107">Excel provides a set of events that an XLL add-in can use in order to manage the life cycle of asynchronous UDF calls. These events indicate that Excel is finished with calculations or that the calculation was canceled.</span></span>
  
### <a name="declaring-an-asynchronous-function"></a><span data-ttu-id="2eb4c-133">éåŒæœŸé–¢æ•°ã‚’å®£è¨€ã—ã¾ã™ã€‚</span><span class="sxs-lookup"><span data-stu-id="2eb4c-133">Declaring an asynchronous function</span></span>

<span data-ttu-id="2eb4c-p108">ï¿½ñ“¯Šï¿½ï¿½Ìƒï¿½ï¿½[ï¿½Uï¿½[ï¿½ï¿½\`ï¿½Öï¿½ï¿½Ì“oï¿½^ï¿½ï¿½ï¿½ÉAï¿½ï¿½ï¿½ï¿½ï¿½ñ“¯Šï¿½ï¿½Æ‚ï¿½ï¿½ÄéŒ¾ï¿½ï¿½ï¿½ï¿½Kï¿½vï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ü‚ï¿½ï¿½Bï¿½ï¿½ï¿½ï¿½ÍAXLOPER12 ï¿½\ï¿½ï¿½ (ï¿½oï¿½^ï¿½^ï¿½Cï¿½vï¿½Ì•ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ "X" ï¿½Æ•\ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½) ï¿½ï¿½|ï¿½Cï¿½ï¿½ï¿½gï¿½ï¿½ï¿½ï¿½pï¿½ï¿½ï¿½ï¿½ï¿½[ï¿½^ï¿½[ï¿½ï¿½ UDF ï¿½pï¿½ï¿½ï¿½ï¿½ï¿½[ï¿½^ï¿½[ï¿½Ìˆê——ï¿½Ì”Cï¿½Ó‚ÌêŠï¿½É’Ç‰ï¿½ï¿½ï¿½ï¿½é‚±ï¿½Æ‚É‚ï¿½ï¿½ï¿½Äï¿½ï¿½sï¿½ï¿½ï¿½ï¿½Ü‚ï¿½ï¿½BExcel ï¿½Å‚ÍAï¿½ï¿½ï¿½Ìƒpï¿½ï¿½ï¿½ï¿½ï¿½[ï¿½^ï¿½[ï¿½ï¿½gï¿½pï¿½ï¿½ï¿½Ä”ñ“¯Šï¿½ï¿½ÌŒÄ‚Ñoï¿½ï¿½ï¿½nï¿½ï¿½ï¿½hï¿½ï¿½ï¿½ï¿½nï¿½ï¿½ï¿½Ü‚ï¿½ï¿½BXLL ï¿½Aï¿½hï¿½Cï¿½ï¿½ï¿½ÍAï¿½ñ“¯Šï¿½ï¿½ÌŒÄ‚Ñoï¿½ï¿½ï¿½nï¿½ï¿½ï¿½hï¿½ï¿½ï¿½ÆAï¿½Öï¿½ï¿½ÌŒï¿½ï¿½Ê‚Ìï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Å‚ï¿½ï¿½ï¿½ï¿½ç‚»ï¿½ÌŒï¿½ï¿½Ê‚ï¿½ Excel ï¿½É“nï¿½ï¿½ï¿½Kï¿½vï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ü‚ï¿½ï¿½Bï¿½ï¿½ï¿½ï¿½ÉAUDF ï¿½Ì–ß‚ï¿½lï¿½ÌŒ^ï¿½ÍAï¿½ï¿½ï¿½ï¿½ï¿½ï¿½^ï¿½ÌÅï¿½ï¿½Ì•ï¿½ï¿½ï¿½ï¿½Æ‚ï¿½ï¿½ï¿½ ">" ï¿½É‚ï¿½ï¿½ï¿½Äwï¿½è‚³ï¿½ï¿½ï¿½ **void** ï¿½Å‚È‚ï¿½ï¿½ï¿½Î‚È‚ï¿½Ü‚ï¿½ï¿½ï¿½BUDF ï¿½Ì“ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ Excel ï¿½É’lï¿½ï¿½Ô‚ï¿½ï¿½È‚ï¿½ï¿½ï¿½ï¿½ßAï¿½ß‚ï¿½lï¿½ÌŒ^ï¿½ï¿½ void ï¿½Å‚ï¿½ï¿½Bï¿½ï¿½ï¿½ï¿½ÉAXLL ï¿½Aï¿½hï¿½Cï¿½ï¿½ï¿½ï¿½ï¿½Rï¿½[ï¿½ï¿½ï¿½oï¿½bï¿½Nï¿½É‚ï¿½ï¿½ï¿½Ä’lï¿½ï¿½ñ“¯Šï¿½ï¿½Å•Ô‚ï¿½ï¿½Ü‚ï¿½ï¿½B</span><span class="sxs-lookup"><span data-stu-id="2eb4c-p108">You must declare asynchronous user-defined functions as asynchronous when they are registered. This is performed by adding a parameter that points to a XLOPER12 structure, represented by "X" in the registration type string, anywhere in the list of UDF parameters. Excel uses this parameter to pass the asynchronous call handle. The XLL add-in must pass the asynchronous call handle and the result of the function back to Excel when the result is ready. In addition, the return type of the UDF should be **void**, designated by ">" as the first character in the type string. The return type is void because the synchronous part of the UDF does not return a value to Excel. Instead, the XLL add-in returns a value asynchronously through a callback.</span></span> 
  
<span data-ttu-id="2eb4c-141">ï¿½ñ“¯Šï¿½ï¿½ÌŠÖï¿½ï¿½ï¿½Xï¿½ï¿½ï¿½bï¿½h ï¿½Zï¿½[ï¿½tï¿½Æ‚ï¿½ï¿½ÄéŒ¾ï¿½ï¿½ï¿½ï¿½ÆAUDF ï¿½Ì“ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½}ï¿½ï¿½ï¿½\`ï¿½Xï¿½ï¿½ï¿½bï¿½hï¿½ÌÄŒvï¿½Zï¿½Ågï¿½pï¿½ï¿½ï¿½ï¿½Ü‚ï¿½ï¿½B</span><span class="sxs-lookup"><span data-stu-id="2eb4c-141">You can declare asynchronous functions as thread-safe and then the synchronous part of the UDF is used in a multi-threaded recalculation.</span></span> 
  
<span data-ttu-id="2eb4c-142">ï¿½ï¿½ï¿½ÌƒRï¿½[ï¿½hï¿½ï¿½ÍA"\>QX" ï¿½ï¿½oï¿½^ï¿½^ï¿½Cï¿½vï¿½Ì•ï¿½ï¿½ï¿½ï¿½ï¿½Æ‚ï¿½ï¿½Ägï¿½pï¿½ï¿½ï¿½Ä“oï¿½^ï¿½ï¿½ï¿½ê‚½ï¿½ñ“¯Šï¿½ï¿½Ìƒï¿½ï¿½[ï¿½Uï¿½[ï¿½ï¿½\`ï¿½Öï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ü‚ï¿½ï¿½B</span><span class="sxs-lookup"><span data-stu-id="2eb4c-142">The following code example shows an asynchronous user-defined function registered by using "\>QX" as the registration type string:</span></span>
  
```cpp
void MyAsyncUDF(LPXLOPER12 arg1, LPXLOPER12 pxAsyncHandle)
{
â€¦
}
```

### <a name="returning-values"></a><span data-ttu-id="2eb4c-143">å€¤ã‚’è¿”ã™</span><span class="sxs-lookup"><span data-stu-id="2eb4c-143">Returning values</span></span>

<span data-ttu-id="2eb4c-144">ï¿½ñ“¯Šï¿½ï¿½ÌŒÄ‚Ñoï¿½ï¿½ï¿½ÌŒï¿½ï¿½Ê‚Ìï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Å‚ï¿½ï¿½ï¿½ï¿½ï¿½Aï¿½^ [xlAsyncReturn](xlasyncreturn.md) ï¿½ÌƒRï¿½[ï¿½ï¿½ï¿½oï¿½bï¿½Nï¿½ï¿½ï¿½ï¿½sï¿½ï¿½ï¿½é‚±ï¿½Æ‚É‚ï¿½ï¿½ï¿½ï¿½ XLL ï¿½Aï¿½hï¿½Cï¿½ï¿½ï¿½Í‚ï¿½ï¿½ÌŒï¿½ï¿½Ê‚ï¿½ Excel ï¿½É•Ô‚ï¿½ï¿½Ü‚ï¿½ï¿½B</span><span class="sxs-lookup"><span data-stu-id="2eb4c-144">When the result of the asynchronous call is ready, the XLL add-in returns the result to Excel by performing a callback of type [xlAsyncReturn](xlasyncreturn.md).</span></span>
  
<span data-ttu-id="2eb4c-p109">**xlAsyncReturn** ï¿½ÍAï¿½ÄŒvï¿½Zï¿½ï¿½ï¿½ÉŒvï¿½Zï¿½ÈŠOï¿½ÌƒXï¿½ï¿½ï¿½bï¿½hï¿½Égï¿½pï¿½Å‚ï¿½ï¿½ï¿½Bï¿½ï¿½ÌƒRï¿½[ï¿½ï¿½ï¿½oï¿½bï¿½Nï¿½Å‚ï¿½ï¿½Bï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ÄAï¿½ñ“¯Šï¿½ï¿½ï¿½ UDF ï¿½Ì”ñ“¯Šï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Å‘ï¿½ï¿½ÌƒRï¿½[ï¿½ï¿½ï¿½oï¿½bï¿½Nï¿½Íï¿½ï¿½sï¿½ï¿½ï¿½È‚ï¿½ï¿½Å‚ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½B</span><span class="sxs-lookup"><span data-stu-id="2eb4c-p109">**xlAsyncReturn** is the only callback you can use on non-calculation threads during recalculation. Therefore, the asynchronous part of an asynchronous UDF should not perform any other callbacks.</span></span> 
  
### <a name="handling-events"></a><span data-ttu-id="2eb4c-147">ã‚¤ãƒ™ãƒ³ãƒˆã®å‡¦ç†</span><span class="sxs-lookup"><span data-stu-id="2eb4c-147">Handling events</span></span>

<span data-ttu-id="2eb4c-p110">Excel 2010 ï¿½È~ï¿½AXLL ï¿½Í”ñ“¯Šï¿½ï¿½Öï¿½ï¿½Ìƒï¿½ï¿½Cï¿½t ï¿½Tï¿½Cï¿½Nï¿½ï¿½ï¿½ï¿½Ç—ï¿½ï¿½ï¿½ï¿½é‚½ï¿½ß‚ÉİŒvï¿½ï¿½ï¿½ê‚½ï¿½Cï¿½xï¿½ï¿½ï¿½gï¿½ï¿½ï¿½Mï¿½Å‚ï¿½ï¿½Ü‚ï¿½ï¿½Bï¿½Ú‚ï¿½ï¿½ï¿½ï¿½ÍAï¿½u[ï¿½Cï¿½xï¿½ï¿½ï¿½gï¿½Ìï¿½ï¿½ï¿½](handling-events.md)ï¿½vï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½B</span><span class="sxs-lookup"><span data-stu-id="2eb4c-p110">Starting in Excel 2010, XLLs can receive events designed to manage the asynchronous function life cycle. For more information, see [Handling Events](handling-events.md).</span></span>
  
## <a name="see-also"></a><span data-ttu-id="2eb4c-150">ï¿½Ö˜Aï¿½ï¿½ï¿½ï¿½</span><span class="sxs-lookup"><span data-stu-id="2eb4c-150">See also</span></span>

- [<span data-ttu-id="2eb4c-151">Excel XLL ï¿½ÌŠJï¿½ï¿½</span><span class="sxs-lookup"><span data-stu-id="2eb4c-151">Developing Excel XLLs</span></span>](developing-excel-xlls.md)

