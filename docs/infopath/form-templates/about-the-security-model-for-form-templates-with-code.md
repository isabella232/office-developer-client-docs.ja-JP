---
title: コードを含むフォーム テンプレートのセキュリティ モデルについて
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
keywords:
- infopath 2007, security,code access security [InfoPath 2007],security [InfoPath 2007], security model for managed code,security [InfoPath 2007], levels,CAS [InfoPath 2007],InfoPath 2003-compatible form templates, security,permissions [InfoPath 2007]
ms.localizationpriority: medium
ms.assetid: 5e1c1c72-f98d-4871-9c57-82c315277aa1
description: InfoPath マネージ コード フォーム テンプレートは、アンマネージ フォーム テンプレートで実行されるスクリプトと同じセキュリティ レベルをサポートしますが, .NET Framework の共通言語ランタイム (CLR) で実行されるマネージ コードに適用される追加のコード アクセス セキュリティ機能もサポートします。
ms.openlocfilehash: 97735f0f707cc73d86b313b5aaac2758de71a5f3
ms.sourcegitcommit: a1d9041c20256616c9c183f7d1049142a7ac6991
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/24/2021
ms.locfileid: "59631385"
---
# <a name="about-the-security-model-for-form-templates-with-code"></a>コードを含むフォーム テンプレートのセキュリティ モデルについて

InfoPath マネージ コード フォーム テンプレートは、アンマネージ フォーム テンプレートで実行されるスクリプトと同じセキュリティ レベルをサポートしますが, .NET Framework の共通言語ランタイム (CLR) で実行されるマネージ コードに適用される追加のコード アクセス セキュリティ機能もサポートします。
  
## <a name="infopath-managed-object-model-security-levels"></a>InfoPath マネージ オブジェクト モデルのセキュリティ レベル

次の表は、セキュリティ オブジェクト モデルのメンバーのセキュリティ レベルと、マネージ コード フォーム テンプレートでそのオブジェクト モデルのメンバーが使用されるときに、各レベルで要求されるアクセス許可のセットの関係を示しています。
  
|**オブジェクト モデルのセキュリティ レベル**|**説明**|**要求されるアクセス許可のセット**|
|:-----|:-----|:-----|
|0  <br/> |制限なくアクセスできます。  <br/> |なし  <br/> |
|2  <br/> |現在開いているフォームと同じドメイン内で実行されているフォーム、またはドメインを越えたアクセス許可を付与されているフォームだけがアクセスできます。  <br/> |なし  <br/> |
|3  <br/> |完全に信頼できるフォームだけがアクセスできます。  <br/> |FullTrust  <br/> |
   
> [!NOTE]
> [!メモ] セキュリティ レベル "1" は現在の InfoPath COM サーバーでは使用されず、将来の使用に備えて予約されています。 
  
> [!IMPORTANT]
> [!重要] オブジェクト モデルのレベル 0 および 2 では、マネージ コードを含むためにアクセス許可のセットは要求されませんが、次のセクションに示すドメイン アクセスのセキュリティ レベル [ドメイン] の定義に従って動作します。 
  
Microsoft.Office.InfoPath アセンブリおよび Microsoft.Office.Interop.InfoPath.SemiTrust アセンブリで公開される各オブジェクト モデルのメンバーのセキュリティ レベルについては、[Microsoft.Office.InfoPath](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.aspx) 名前空間および [Microsoft.Office.Interop.InfoPath.SemiTrust](https://msdn.microsoft.com/library/Microsoft.Office.Interop.InfoPath.SemiTrust.aspx) 名前空間のそのメンバーについて説明しているトピックの「解説」に記載されています。 
  
## <a name="infopath-domain-access-security-levels"></a>InfoPath ドメイン アクセスのセキュリティ レベル

InfoPath では、InfoPath アプリケーションで公開される COM サーバーによって強制されるオブジェクト モデルのセキュリティ レベルと関連して、フォーム テンプレートの場所、フォームの展開方法、およびデザイン モードでの設定に応じて適用される 3 つのセキュリティ レベルが定義されます。これらの 3 つのセキュリティ レベルを次の表に示します。
  
|**ドメイン アクセスのセキュリティ レベル**|**説明**|
|:-----|:-----|
|制限あり  <br/> |フォーム テンプレート外部での通信は許可されません。 このセキュリティ レベルでは、有害なフォームがコンピューターから悪意のある攻撃者へデータを転送することが防止されます。 このセキュリティ モードで実行しているときには、カスタム作業ウィンドウ、データ接続 (電子メールの送信を除く)、ActiveX コントロール、マネージ コード フォーム コード、ロール、およびワークフローの各機能は使用できません。 マネージ コード フォーム テンプレートは、"制限あり" のドメインでは実行できません。 マネージ コード フォーム テンプレートに関して、[ **フォームのオプション**] ダイアログ ボックスの [ **セキュリティと信頼**] カテゴリで [ **自動的にセキュリティ レベルを設定する**] がオンになっている場合、コードを実行するには、常に少なくとも [ドメイン] セキュリティ アクセス レベルが必要です。  <br/><br/>**重要**: マネージ コード フォーム テンプレート用に作成されたマネージ コード アセンブリは、"制限あり" のドメインからフォームが開かれた場合 (たとえば、電子メールの添付ファイルとして送信された InfoPath フォームから開かれた場合) は読み込まれず、実行されません。 電子メールの添付ファイルとして展開するフォーム テンプレートには、上記の機能を含めないようにする必要があります。フォーム テンプレートにフォーム コードが含まれる場合、フォーム コードは JScript または VBScript で実装し、セキュリティ レベル 0 のオブジェクト モデルのメンバーのみを使用する必要があります。           |
|ドメイン  <br/> |Microsoft Internet Explorer で定義されているセキュリティ ゾーンでのフォームの場所に応じて、フォームが制限されます。たとえば、フォームがローカル イントラネット ゾーンにある場合、そのドメイン内の他のデータと通信することは許可されますが、他のドメインからデータを取得することは許可されません。Microsoft Internet Explorer のセキュリティ ゾーンにより、スクリプトが安全に使用できない可能性があるとマークされている ActiveX コントロールの実行を許可するかどうかも決定されます。  <br/> |
|完全信頼  <br/> |フォームが使用されるコンピューターで、完全な信頼によりフォームを実行することが許可されます。このセキュリティ レベルを使用できるのは、コンピューターの信頼されたルート発行元に一致する署名によりデジタル署名されたフォームを操作する場合か、フォームをインストールし、フォーム定義ファイル (.xsf) で **xDocumentClass** 要素の **requireFullTrust** 属性を "yes" に設定するインストール プログラムを作成する場合のみです。この設定を使用すると、フォームはオブジェクト モデルのセキュリティ レベル 3 を必要とするオブジェクト モデル (ファイル システムにアクセスするプロパティとメソッドなど) の呼び出しにアクセスすることができ、より制限の高いセキュリティ レベルで実行するときに表示される、特定のセキュリティ プロンプトを無効にすることができます  <br/> |
   
既定では、フォーム テンプレートで使用されている機能と、フォーム テンプレートの展開場所および展開方法に応じて、InfoPath フォームは [制限あり] セキュリティ レベルまたは [ドメイン] セキュリティ レベルを自動的に選択するように構成されます。 たとえば、電子メールの添付ファイルとして展開されたフォーム テンプレートは、[制限あり] セキュリティ レベルに自動的に構成されます。 ユーザーおよびデータの保護レベルを高めるために、このセキュリティ設定は常に可能な限り高い制限となり、[制限あり] で開始されます。 マネージ コードを含むフォーム テンプレートがセキュリティ レベルを自動的に選択するように設定される場合、コードを実行するには、フォーム テンプレートでは常に少なくとも [ドメイン] セキュリティ アクセス レベルが必要になります。 次の手順を使用すると、デザイン時にこの設定を上書きし、フォームでより適切なセキュリティ レベルを選択することができます。 
  
### <a name="specify-a-forms-security-level"></a>フォームのセキュリティ レベルを指定する

1. InfoPath フォーム デザイナーでフォームを開き、[ **ファイル**] タブをクリックして、[ **情報**] タブの [ **フォームのオプション**] をクリックします。
    
2. [ **フォームのオプション**] ダイアログ ボックスの [ **セキュリティと信頼**] カテゴリをクリックします。 
    
3. [ **自動的にセキュリティ レベルを設定する (推奨)**] チェック ボックスをオフにします。 
    
4. 目的のセキュリティ レベルを選択します。
    
> [!NOTE] 
> - マネージ コード フォーム テンプレートで [ **制限あり**] セキュリティ レベルを選択すると、フォーム コードで使用されるオブジェクト モデルのメンバーにかかわらず、フォームの分離コードは読み込まれず、実行されません。 このセキュリティ レベルは、主に電子メールを使用して展開される InfoPath フォームを対象としています。     
> - セキュリティ レベルとして **[完全信頼]** を選択した場合は、フォームをデジタル署名するか、またはインストールして登録する必要があります。 詳細については、「[コードを含む InfoPath フォーム テンプレートを展開する](how-to-deploy-infopath-form-templates-with-code.md)」を参照してください。
    
次の表は、InfoPath セキュリティ モデルの概要を示しています。最初の列には、フォームで指定されるレベルまたは必要なレベルを示します。2 つ目および 3 つ目の列には、場所の URN 識別子または URL 識別子がフォームに含まれるかどうかを示します。その他の列には、実行が許可される項目を示します。展開のシナリオと、マネージ コード フォーム テンプレートのアクセス許可の詳細については、このトピックの後で説明する「共通言語ランタイム コードのアクセス セキュリティ機能」を参照してください。
  
|**フォームで必要なレベル**|**URN 識別子を含む**|**URL 識別子を含む**|**スクリプトの実行は安全ではないとマークされている ActiveX**|**クロス ドメイン アクセス**|**マネージ コード**|**オブジェクト モデルのセキュリティ**|
|:-----|:-----|:-----|:-----|:-----|:-----|:-----|
|制限あり  <br/> ||X  <br/> |ActiveX はまったく実行されない  <br/> |失敗  <br/> |フォームは読み込まれるが、マネージ コードは実行されない  <br/> |0  <br/> |
|ドメイン (Internet Explorer の [ **制限付きサイト**] ゾーン)  <br/> |まったく実行されない  <br/> |まったく実行されない  <br/> |まったく実行されない  <br/> |まったく実行されない  <br/> |まったく実行されない  <br/> |まったく実行されない  <br/> |
|ドメイン (Internet Explorer の [ **インターネット**] ゾーン)  <br/> |X  <br/> ||失敗  <br/> |失敗  <br/> |まったく実行されない  <br/> |0  <br/> |
|ドメイン (Internet Explorer の [ **ローカル イントラネット**] ゾーン)  <br/> |X  <br/> ||失敗  <br/> |ダイアログを表示する  <br/> |マネージ コードは [ **ローカル イントラネット**] のアクセス許可により実行される  <br/> |2  <br/> |
|ドメイン (Internet Explorer の [ **信頼済みサイト**] ゾーン)  <br/> |X  <br/> ||ダイアログを表示する  <br/> |OK  <br/> |マネージ コードは [ **インターネット**] のアクセス許可により実行される。クロス ドメイン アクセスは許可される。フォームは [ **信頼済みサイト**] ゾーンだが、[ **インターネット**] ゾーンのアクセス許可が適用されることに注意すること。  <br/> |2  <br/> |
|ドメイン (Internet Explorer の [ **ローカル コンピューター**] ゾーン)  <br/> |X  <br/> |X  <br/> |ダイアログを表示する  <br/> |失敗  <br/> |マネージ コードは [ **ローカル イントラネット**] のアクセス許可により実行される  <br/> |2  <br/> |
|完全信頼  <br/> |X  <br/> |X  <br/> |OK  <br/> |OK  <br/> |完全信頼  <br/> |3  <br/> |
   
> [!IMPORTANT]
> 上記の説明で "スクリプトの実行は安全ではないとマークされている ActiveX" 列および "クロス ドメイン アクセス" 列では、Microsoft Internet Explorer の既定のセキュリティ設定が使用されることを前提としています。ユーザーがセキュリティ設定を変更した場合、InfoPath の動作はそれに応じて変更されます。たとえば、[ **ローカル イントラネット**] ゾーンで [ **ドメイン間でのデータ ソースのアクセス**] を [ **有効にする**] に設定した場合、上の表のようにクロス ドメイン アクセスを許可するかどうかを確認するダイアログ ボックスは表示されません。 
  
## <a name="common-language-runtime-code-access-security-features"></a>共通言語ランタイム コードのアクセス セキュリティ機能

InfoPath マネージ コード フォーム テンプレートをコンパイルすると、フォーム コードのロジックの実装を含むプライベート マネージ コード アセンブリが作成されます。
  
.NET Framework では、既定でマネージ コード アセンブリはローカル マシンでの実行時に完全信頼アクセス許可が設定され、イントラネットでの実行時には完全信頼アクセス許可は与えられません。セキュリティ ポリシーをより詳細に管理し、InfoPath マネージ コード フォーム テンプレートをイントラネットから完全に信頼されたフォームとして実行するオプションを提供するために、InfoPath には次のセキュリティ アーキテクチャが実装されています。
  
- InfoPath アプリケーションは, .NET Framework 共通言語ランタイム (CLR) をホストします。
    
- InfoPath でホストされる CLR 内で、各マネージ コード フォーム テンプレートは異なるアプリケーション ドメインで実行されます。これは、マネージ コードを実行するための分離、アンロード、およびセキュリティの境界を備えた環境です。
    
- InfoPath では、フォーム テンプレートに関連付けられた信頼のレベルと場所の URL に応じて、アプリケーション ドメインに既定のセキュリティ ポリシーが設定されます。
    
- 既定では、ローカル コンピューター ([マイ コンピューター ゾーン] コード グループ) で実行されるマネージ コード フォーム テンプレートには、完全信頼 (ローカル イントラネット ゾーンのアクセス許可) よりも低いレベルのアクセス許可が与えられます。完全信頼アクセス許可を得るには、フォームを登録するか、信頼済みの証明書を使用してデジタル署名する必要があります。
    
マネージ コード フォーム テンプレートのアプリケーション ドメインに設定された既定のセキュリティ ポリシーにより、InfoPath ドメイン アクセスのセキュリティ レベルと、追加の .NET セキュリティ制限が確実に実施されます。InfoPath セキュリティ システムでは、さらに柔軟性を高めるために、"InfoPath フォーム テンプレート" という名前の .NET コード アクセス セキュリティ コード グループが認識されます。このコード グループがユーザーのコンピューターに存在する場合、そのセキュリティ構成と、グループ内の子コード グループのセキュリティ構成が、アプリケーションのドメインに適用されます。
  
> [!IMPORTANT] 
> - InfoPath フォーム テンプレートのコード グループは、マネージ コードのフォーム コード アセンブリにのみ適用されます。その結果、InfoPath マネージ コードのフォーム コードに完全信頼アクセス許可のセットを付与しても、フォーム テンプレートをインストールおよび登録 (またはデジタル署名) していない場合 (この操作を行うと、フォーム テンプレート全体が完全に信頼されます)、フォーム コードからセキュリティ レベル 3 のオブジェクト モデルのメンバーの呼び出しは失敗します。   
> - ハッシュ、厳密な名前、または発行元の証拠を使用して、制限されたアクセス許可のセットによって構成されたアセンブリを参照するか明示的に読み込み (Assembly.Load)、フォーム テンプレート プロジェクトでのメンバーシップの状態を判断する場合、アセンブリはフォーム テンプレートによって読み込まれ、実行されます。
    
InfoPath フォーム テンプレートのコード グループを作成し、構成する方法については、「[コードを含むフォーム テンプレートのセキュリティ設定を構成する](how-to-configure-security-settings-for-form-templates-with-code.md)」を参照してください。
  
次の表は、マネージ コード フォーム テンプレートに適用されるアクセス許可のセットと展開シナリオをまとめたものです。
  
|**展開シナリオ**|**アクセス許可のセット**|**メモ**|
|:-----|:-----|:-----|
|フォーム テンプレートがローカル コンピューターで発行され、開発者は Visual Studio を使用してフォーム コードを記述し、デバッグする。  <br/> |ローカル イントラネットのアクセス許可のセット  <br/> グローバル アセンブリ キャッシュ (GAC) にインストールされ、 **AllowPartiallyTrustedCallersAttribute** 属性でマークされたアセンブリには、完全許可アクセス許可のセットが付与されます。  <br/> |既定では、ローカル コンピューターから実行されているフォーム テンプレートには完全信頼アクセス許可のセットは付与されません。 完全信頼アクセス許可を必要とするオブジェクト モデルのメンバーの機能を使用し、呼び出すフォーム テンプレートを開発するときは、「[完全信頼が必要なフォーム テンプレートをプレビューおよびデバッグする](how-to-preview-and-debug-form-templates-that-require-full-trust.md)」に記載された手順を使用することができます。  <br/> |
|フォーム テンプレートがローカル コンピューターに発行され、ローカル コンピューターで完全信頼アクセス許可のセットを要求するカスタム アセンブリを参照する。  <br/> |ローカル イントラネットのアクセス許可のセット  <br/> グローバル アセンブリ キャッシュ (GAC) にインストールされ、 **AllowPartiallyTrustedCallersAttribute** 属性でマークされたアセンブリには、完全許可アクセス許可のセットが付与されます。カスタム アセンブリには、ローカル イントラネットのアクセス許可のセットが付与されます。  <br/> |開発者は、フォーム テンプレートのコードで使用する外部アセンブリを参照するには、InfoPath フォーム テンプレートのコード グループを使用して、フォーム テンプレートのコードで参照される外部アセンブリに完全信頼 (または適切なアクセス許可セット) を付与する必要があります。InfoPath では、グローバル アセンブリ キャッシュ (GAC) にインストールされるものを除き、外部アセンブリに関する仮定項目はありません。開発者は、マイ コンピューター ゾーンのコード グループで付与されるアクセス許可によって既にアセンブリが信頼されている場合でも、InfoPath フォーム テンプレートのコード グループを使用して、必要なアクセス許可を明示的にアセンブリに付与する必要があります。  <br/> |
|フォーム テンプレートは、ファイル共有、SharePoint フォーム ライブラリ、Web サーバーなど、ローカル イントラネットの共有された場所に発行される。  <br/> |ローカル イントラネットのアクセス許可のセット  <br/> グローバル アセンブリ キャッシュ (GAC) にインストールされ、 **AllowPartiallyTrustedCallersAttribute** 属性でマークされたアセンブリには、完全許可アクセス許可のセットが付与されます。  <br/> ||
|フォーム テンプレートは、ファイル共有、SharePoint フォーム ライブラリ、Web サーバーなど、Internet Explorer で信頼済みサイトと指定された、ローカル イントラネット内の共有された場所に発行される。  <br/> |インターネット アクセス許可のセット  <br/> Microsoft および ECMA によって署名されたアセンブリには、完全信頼アクセス許可のセットが付与されます。  <br/> |CLR コードのアクセス セキュリティにより、Internet Explorer で信頼済みサイトと指定されたサイトには、インターネット アクセス許可のセットのみが付与されます。InfoPath ではこのポリシーがそのまま使用されます。これは、フォーム コードにスクリプトを使用する InfoPath フォーム テンプレートとは異なります。InfoPath フォーム テンプレートでは、信頼済みサイト ゾーンに発行されるときに、より高いレベルのアクセス許可が与えられます。  <br/> |
|フォーム テンプレートはインターネット上の場所からダウンロードまたはコピーされる。  <br/> |既定では、何も付与されません。フォーム テンプレートのマネージ コード アセンブリは読み込まれず、実行されません。  <br/> ||
   
## <a name="see-also"></a>関連項目

- [コードを含むフォーム テンプレートのセキュリティ設定を構成する](how-to-configure-security-settings-for-form-templates-with-code.md)
- [完全信頼が必要なフォーム テンプレートをプレビューおよびデバッグする](how-to-preview-and-debug-form-templates-that-require-full-trust.md)

